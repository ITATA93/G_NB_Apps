{
  "$schema": "./schema.json",
  "version": "3.1",
  "project": "g-nb-apps",
  "description": "Sub-agent configuration for G_NB_Apps (MIRA Hospital) with multi-vendor support (Gemini, Claude Opus 4.6, Codex)",
  "vendors": {
    "available": ["gemini", "claude", "codex"],
    "default": "gemini",
    "codex_partial": true,
    "codex_capabilities": {
      "mcp": true,
      "skills": true,
      "web_search": true,
      "task_tool": false,
      "note": "Full featured except Task tool (no parallel subagents)"
    },
    "claude_capabilities": {
      "model": "opus-4.6",
      "release_date": "2026-02-05",
      "context_window": "1M (beta)",
      "max_output_tokens": 128000,
      "effort_levels": ["low", "medium", "high", "max"],
      "adaptive_thinking": true,
      "agent_teams": true,
      "compaction_api": true,
      "streaming_required_for_large_output": true,
      "commands": ["/insights", "/debug", "/compact"],
      "pricing": {
        "standard": { "input_per_million": "$5", "output_per_million": "$25" },
        "premium_over_200k": {
          "input_per_million": "$10",
          "output_per_million": "$37.50"
        }
      }
    }
  },
  "trigger_resolution": {
    "strategy": "priority",
    "note": "When multiple agents match, highest priority (lowest number) wins. If tie, first in list.",
    "conflict_examples": {
      "audit code": "code-reviewer (priority 2) beats code-analyst (priority 3)",
      "documentation": "researcher (priority 1) for external docs, doc-writer (priority 4) for project docs",
      "nocobase schema": "db-analyst (priority 6) for DB design, code-analyst (priority 3) for API analysis"
    }
  },
  "teams": {
    "full-review": {
      "agents": ["code-reviewer", "test-writer", "doc-writer"],
      "mode": "parallel",
      "use_case": "Comprehensive pre-merge review: code quality + test coverage + docs sync"
    },
    "feature-pipeline": {
      "agents": ["code-analyst", "test-writer", "code-reviewer"],
      "mode": "sequential",
      "use_case": "TDD pipeline: analyze -> write tests -> review implementation"
    },
    "deep-audit": {
      "agents": ["code-reviewer", "db-analyst", "deployer"],
      "mode": "parallel",
      "use_case": "Full-stack audit: code security + database + infrastructure"
    },
    "rapid-fix": {
      "agents": ["code-analyst", "code-reviewer"],
      "mode": "sequential",
      "use_case": "Quick bug diagnosis and validation"
    },
    "full-audit": {
      "agents": ["code-reviewer", "code-analyst"],
      "mode": "sequential",
      "use_case": "Full project audit with orchestrator oversight"
    },
    "code-and-review": {
      "agents": ["code-analyst", "code-reviewer"],
      "mode": "sequential",
      "use_case": "Generate code then review for quality and security"
    },
    "research-and-document": {
      "agents": ["researcher", "doc-writer"],
      "mode": "sequential",
      "use_case": "Research a topic then document findings"
    },
    "adversarial-review": {
      "agents": ["code-analyst", "code-reviewer"],
      "mode": "sequential",
      "context_isolation": true,
      "use_case": "Generate code then have isolated critic validate output"
    },
    "design-and-deploy": {
      "agents": ["ui-designer", "code-reviewer", "deployer", "visual-verifier"],
      "mode": "sequential",
      "use_case": "Design UI layout, review for accessibility/UX, deploy pages, then verify visually"
    },
    "full-app-pipeline": {
      "agents": ["db-analyst", "ui-designer", "test-writer", "code-reviewer", "visual-verifier"],
      "mode": "sequential",
      "use_case": "Full app build: schema design → UI layout → tests → review → visual verification"
    },
    "deploy-and-verify": {
      "agents": ["deployer", "visual-verifier"],
      "mode": "sequential",
      "use_case": "Deploy pages/routes via API then verify they render correctly in the browser"
    }
  },
  "agents": [
    {
      "id": "researcher",
      "name": "researcher",
      "vendor_preference": "codex",
      "supported_vendors": ["gemini", "claude", "codex"],
      "scope": "global",
      "priority": 1,
      "triggers": ["research", "investigate", "find docs", "documentation", "best practices", "API reference", "official docs", "nocobase docs"],
      "instructions": "Deep research for documentation, APIs, best practices. Always cite sources. Read-only, never modify files. With 1M context, ingest full documentation sets when available. Domain: Hospital Publico / NocoBase clinical apps.",
      "codex_config": { "effort": "xhigh", "deep_research": true },
      "claude_config": { "model": "opus-4.6", "effort": "max", "adaptive_thinking": true, "allow_parallel": true },
      "gemini_config": { "model": "pro", "thinking_mode": true }
    },
    {
      "id": "code-reviewer",
      "name": "code-reviewer",
      "vendor_preference": "claude",
      "supported_vendors": ["gemini", "claude", "codex"],
      "scope": "project",
      "priority": 2,
      "triggers": ["review", "audit", "bugs", "security", "code quality"],
      "instructions": "Review code for bugs and security. Report only, never modify. Use maximum reasoning depth for security-critical findings. Pay special attention to NocoBase API token handling and patient data exposure.",
      "codex_config": { "effort": "high", "sequential_warning": true },
      "claude_config": { "model": "opus-4.6", "effort": "max", "adaptive_thinking": true, "allow_parallel": true },
      "gemini_config": { "model": "pro", "thinking_mode": true }
    },
    {
      "id": "code-analyst",
      "name": "code-analyst",
      "vendor_preference": "gemini",
      "supported_vendors": ["gemini", "claude", "codex"],
      "scope": "project",
      "priority": 3,
      "triggers": ["analyze", "explain", "how works", "structure", "architecture"],
      "instructions": "Analyze code and architecture. Read-only, never modify. With 1M context, request ALL relevant files rather than fragments. Understands NocoBase collection/field/workflow patterns.",
      "codex_config": { "effort": "high", "sequential_warning": true },
      "claude_config": { "model": "opus-4.6", "effort": "high", "adaptive_thinking": true, "allow_parallel": true },
      "gemini_config": { "model": "pro", "thinking_mode": true }
    },
    {
      "id": "doc-writer",
      "name": "doc-writer",
      "vendor_preference": "gemini",
      "supported_vendors": ["gemini", "claude", "codex"],
      "scope": "project",
      "priority": 4,
      "triggers": ["document", "README", "CHANGELOG", "DEVLOG", "docs"],
      "instructions": "Maintain documentation. Read before modifying. Never delete existing content. Follow output governance in docs/standards/output_governance.md.",
      "codex_config": { "effort": "medium" },
      "claude_config": { "model": "opus-4.6", "effort": "medium", "adaptive_thinking": true, "allow_parallel": true },
      "gemini_config": { "model": "flash" }
    },
    {
      "id": "test-writer",
      "name": "test-writer",
      "vendor_preference": "gemini",
      "supported_vendors": ["gemini", "claude", "codex"],
      "scope": "project",
      "priority": 5,
      "triggers": ["test", "coverage", "pytest", "jest", "vitest", "unit test", "integration test"],
      "instructions": "Create tests. Use mocks for external dependencies. Never use real patient data. Vitest for TS, pytest for Python.",
      "codex_config": { "effort": "high" },
      "claude_config": { "model": "opus-4.6", "effort": "high", "adaptive_thinking": true, "allow_parallel": true },
      "gemini_config": { "model": "pro" }
    },
    {
      "id": "db-analyst",
      "name": "db-analyst",
      "vendor_preference": "claude",
      "supported_vendors": ["gemini", "claude", "codex"],
      "scope": "project",
      "priority": 6,
      "triggers": ["database", "SQL", "query", "schema", "migration", "optimize", "collection", "nocobase schema"],
      "instructions": "Database and NocoBase collection analysis. NEVER execute DELETE/DROP/UPDATE without confirmation. Use maximum reasoning for schema design. Familiar with ALMA data model for oncology/clinical records.",
      "codex_config": { "effort": "xhigh", "sequential_warning": true },
      "claude_config": { "model": "opus-4.6", "effort": "max", "adaptive_thinking": true, "allow_parallel": false },
      "gemini_config": { "model": "pro", "thinking_mode": true }
    },
    {
      "id": "deployer",
      "name": "deployer",
      "vendor_preference": "gemini",
      "supported_vendors": ["gemini", "claude", "codex"],
      "scope": "project",
      "priority": 7,
      "triggers": ["deploy", "docker", "CI/CD", "kubernetes", "github actions", "nocobase deploy"],
      "instructions": "Deployment configuration. Never include secrets in files. Understands NocoBase collection deployment via API and TypeScript scripts.",
      "codex_config": { "effort": "high" },
      "claude_config": { "model": "opus-4.6", "effort": "high", "adaptive_thinking": true, "allow_parallel": true },
      "gemini_config": { "model": "pro" }
    },
    {
      "id": "ui-designer",
      "name": "ui-designer",
      "vendor_preference": "gemini",
      "supported_vendors": ["gemini", "claude", "codex"],
      "scope": "project",
      "priority": 8,
      "triggers": ["design", "UI", "UX", "layout", "page design", "dashboard", "frontend", "beautiful", "visual", "kanban", "calendar view"],
      "instructions": "Design functional and beautiful NocoBase interfaces for hospital apps. Clinical-first: large touch targets, high contrast, WCAG 2.1 AA. Produce deployable specs using deploy-routes.ts, deploy-blocks.ts, deploy-ui-pages.ts. Read docs/standards/nocobase-page-block-deployment.md BEFORE designing. Output designs to docs/plans/.",
      "codex_config": { "effort": "high" },
      "claude_config": { "model": "opus-4.6", "effort": "high", "adaptive_thinking": true, "allow_parallel": true },
      "gemini_config": { "model": "pro", "thinking_mode": true }
    },
    {
      "id": "visual-verifier",
      "name": "visual-verifier",
      "vendor_preference": "claude",
      "supported_vendors": ["gemini", "claude", "codex"],
      "scope": "project",
      "priority": 9,
      "triggers": ["verify page", "visual check", "browser verify", "screenshot", "page renders", "visual validation", "playwright"],
      "instructions": "Browser-based visual verification of NocoBase pages using Playwright. After pages are created via API, navigates to them in a real browser to verify they render correctly. Takes screenshots, checks for console errors, counts rendered blocks. Uses scripts/verify-page-visual.ts and scripts/validate-ui-browser.ts.",
      "codex_config": { "effort": "high" },
      "claude_config": { "model": "opus-4.6", "effort": "high", "adaptive_thinking": true, "allow_parallel": true },
      "gemini_config": { "model": "pro" }
    }
  ]
}
